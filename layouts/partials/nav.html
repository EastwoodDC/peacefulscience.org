{{ $currentPage := . }}
{{ $menu := .Site.Menus.main  }}


<div style="height: 40px; width: 100%"></div> 

<nav id="navbar" class="navbar navbar-expand-lg  fixed-top navbar-dark w-100 border-bottom shadow" style="background-image: linear-gradient(-30deg, #000f, #020f); transition: .3s ease-in;">


 <a class="navbar-brand font-special text-light text-larger" href="/">Peaceful Science</a>

    <button class="navbar-toggler shake text-white btn btn-outline-primary" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-bars"></i>
  </button>

  
  <div class="collapse navbar-collapse" id="navbarNavDropdown">

    <ul class="navbar-nav mr-auto">


<li class="nav-item"> <a class="nav-link grey-white-pulse" id="open-popup"  style="cursor: pointer;" onclick='document.getElementById("subscribe").classList.toggle("active");'> Subscribe</a> </li>




        {{ range $menu }}
            {{- if .Children -}}
               {{- $active := eq .URL $currentPage.RelPermalink }}
               {{- range .Children }}
                 {{- if eq .URL $currentPage.RelPermalink }}
                   {{- $active = true }}
                 {{- end }}
               {{- end }}
               
               <li class="nav-item dropdown">
               <a class="nav-link dropdown-toggle {{ if $active }} active{{ end }}" href="#"  id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ .Pre }}{{ .Name }}</a>
               <div class="dropdown-menu bg-dark text-light" aria-labelledby="navbarDropdown">
                 {{ range sort .Children "Weight" "desc" }}                    
                    {{ if  eq .URL $currentPage.RelPermalink }}
                      <a class="dropdown-item active" href="#">  {{ .Pre }}{{ .Name }} <span class="sr-only">(current)</span></a>
                    {{ else }}
                      <a class="dropdown-item text-muted" href="{{ .URL | absURL }}">{{ .Pre }}{{ .Name }}</a>
                    {{ end }}
                 {{ end }}
                </div>
				</li>

            {{ else }}
                {{ if eq .URL $currentPage.RelPermalink}}
                <li class="nav-item active">  
                    <a class="nav-link" href="#">{{ .Pre }}{{ .Name }} <span class="sr-only">(current)</span></a>
                </li>
                {{ else }}
                <li class="nav-item">  
                    <a class="nav-link" href="{{ .URL | absURL }}">{{ .Pre }}{{ .Name }}</a>
                </li>
                {{ end }}
                
            {{ end }}

        {{ end }}

    </ul>
           
           
     <form class="form-inline"  action="/search/" method="get" target="_blank">
    <button class=""  style="visibility: hidden" type="submit">Search</button>    
    <input class="form-control  text-light" type="search" name="query" style="color: white; background: none; outline: none; border: none; border-bottom: 2px" placeholder="Search" aria-label="Search">
      </form>
  

  <div class=" nav-item text-light d-block text-larger my-1"  style=" word-spacing: 10px;" >
   
    <a href="https://www.facebook.com/peacefulscience.org/" target="_blank"  rel=”nofollow” class="text-light"><i class="fab fa-facebook"></i></a>

    <a href="https://www.youtube.com/channel/UCv9gNGOpR7mH4usLW4cpNvg" target="_blank"  rel=”nofollow” class="text-light"><i class="fab fa-youtube"></i></a>

    <a href="https://twitter.com/PeacefulScience" target="_blank"   rel=”nofollow” class="text-light"><i class="fab fa-twitter"></i> </a>

  </div>
  
  <!-->      <a href="http://eepurl.com/dINfpn" target="_blank" class="btn btn-outline-light my-4 my-sm-2 shake" >Join Our Mailing List</a> -->
  </div>

  


 
</nav>



<script defer> 

var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;
  if (prevScrollpos > currentScrollPos || currentScrollPos < 80) {
	    document.getElementById("navbar").style.top = "0";
  } else {
	    document.getElementById("navbar").style.top = "-60px";
  }
  prevScrollpos = currentScrollPos;
}



let navbarToggler = document.querySelector('.navbar-toggler');
let navbarDropdown = document.querySelector('#navbarNavDropdown');
let navbarDropdownExpanded = navbarDropdown.getAttribute('aria-expanded');

// Mobile menu toggle

navbarToggler.addEventListener('click', function(){
  navbarDropdown.classList.toggle('show');

  if(navbarDropdownExpanded == "true") {
    navbarDropdownExpanded = "false";
  } else {
    navbarDropdownExpanded = "true";
  }

  navbarDropdown.setAttribute("aria-expanded", navbarDropdownExpanded);
});

// Dropdown toggle

function getTogglerId(className, event, fn) {
  let list = document.querySelectorAll(className);
  for (let i = 0, len = list.length; i < len; i++) {
      list[i].addEventListener(event, fn, false);
  }
}

getTogglerId('.dropdown-toggle', 'click', toggleDropdown);

let dropdownMenus = document.querySelectorAll('.dropdown-menu');
let dropdownTogglers = document.querySelectorAll('.dropdown-toggle');

function closeMenus(){
  for (let j = 0; j < dropdownMenus.length; j++) {
    dropdownMenus[j].classList.remove('show');
  }
  for (let k = 0; k < dropdownTogglers.length; k++) {
    dropdownTogglers[k].classList.remove('show');
    dropdownTogglers[k].setAttribute('aria-expanded','false');
  }
}

function toggleDropdown(e) {
  let isOpen = this.classList.contains('show');

  if (!isOpen) {
    closeMenus();
    document.querySelector(`[aria-labelledby=${this.id}]`).classList.add('show');
    this.classList.add('show');
    this.setAttribute('aria-expanded','true');
  } else if (isOpen) {
    closeMenus();
  }

  e.preventDefault();
}

// Close dropdowns on focusout

let navbar = document.querySelector('.navbar');

navbar.addEventListener('focusout', function() {

  window.onclick = function(event){
    if (document.querySelector('.navbar').contains(event.target)){
      return;
    } else{
      closeMenus();
    }
  };
});
</script>

