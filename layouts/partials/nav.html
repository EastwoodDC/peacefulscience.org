{{ $currentPage := . }}
{{ $menu := .Site.Menus.main  }}

<nav class="navbar navbar-expand-lg  position-sticky navbar-dark w-100 border-bottom shadow" style="background-image: linear-gradient(-30deg, #000, #020)">
 <a class="navbar-brand font-special text-light" href="/">Peaceful Science</a>


  <button class="navbar-toggler shake" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  
  
  <div class="collapse navbar-collapse" id="navbarNavDropdown">

    <ul class="navbar-nav mr-auto">

<li class="nav-item"> <a class="nav-link grey-white-pulse" target="_blank" href="http://eepurl.com/dINfpn"> Subscribe</a> </li>
    
      
      
        {{ range $menu }}

            {{- if .Children -}}
               {{- $active := eq .URL $currentPage.RelPermalink }}
               {{- range .Children }}
                 {{- if eq .URL $currentPage.RelPermalink }}
                   {{- $active = true }}
                 {{- end }}
               {{- end }}
               
               <li class="nav-item dropdown">
               <a class="nav-link dropdown-toggle {{ if $active }} active{{ end }}" href="#"  id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ .Pre }}{{ .Name }}</a>
               <div class="dropdown-menu bg-dark text-light" aria-labelledby="navbarDropdown">
                 {{ range sort .Children "Weight" "desc" }}                    
                    {{ if  eq .URL $currentPage.RelPermalink }}
                      <a class="dropdown-item active" href="#">  {{ .Pre }}{{ .Name }} <span class="sr-only">(current)</span></a>
                    {{ else }}
                      <a class="dropdown-item text-muted" href="{{ .URL | absURL }}">{{ .Pre }}{{ .Name }}</a>
                    {{ end }}
                 {{ end }}
                </div>
				</li>

            {{ else }}
                {{ if eq .URL $currentPage.RelPermalink}}
                <li class="nav-item active">  
                    <a class="nav-link" href="#">{{ .Pre }}{{ .Name }} <span class="sr-only">(current)</span></a>
                </li>
                {{ else }}
                <li class="nav-item">  
                    <a class="nav-link" href="{{ .URL | absURL }}">{{ .Pre }}{{ .Name }}</a>
                </li>
                {{ end }}
                
            {{ end }}

        {{ end }}
    </ul>

<!-->      <a href="http://eepurl.com/dINfpn" target="_blank" class="btn btn-outline-light my-4 my-sm-2 shake" >Join Our Mailing List</a> -->
  </div>
 
</nav>



<script defer> 
let navbarToggler = document.querySelector('.navbar-toggler');
let navbarDropdown = document.querySelector('#navbarNavDropdown');
let navbarDropdownExpanded = navbarDropdown.getAttribute('aria-expanded');

// Mobile menu toggle

navbarToggler.addEventListener('click', function(){
  navbarDropdown.classList.toggle('show');

  if(navbarDropdownExpanded == "true") {
    navbarDropdownExpanded = "false";
  } else {
    navbarDropdownExpanded = "true";
  }

  navbarDropdown.setAttribute("aria-expanded", navbarDropdownExpanded);
});

// Dropdown toggle

function getTogglerId(className, event, fn) {
  let list = document.querySelectorAll(className);
  for (let i = 0, len = list.length; i < len; i++) {
      list[i].addEventListener(event, fn, false);
  }
}

getTogglerId('.dropdown-toggle', 'click', toggleDropdown);

let dropdownMenus = document.querySelectorAll('.dropdown-menu');
let dropdownTogglers = document.querySelectorAll('.dropdown-toggle');

function closeMenus(){
  for (let j = 0; j < dropdownMenus.length; j++) {
    dropdownMenus[j].classList.remove('show');
  }
  for (let k = 0; k < dropdownTogglers.length; k++) {
    dropdownTogglers[k].classList.remove('show');
    dropdownTogglers[k].setAttribute('aria-expanded','false');
  }
}

function toggleDropdown(e) {
  let isOpen = this.classList.contains('show');

  if (!isOpen) {
    closeMenus();
    document.querySelector(`[aria-labelledby=${this.id}]`).classList.add('show');
    this.classList.add('show');
    this.setAttribute('aria-expanded','true');
  } else if (isOpen) {
    closeMenus();
  }

  e.preventDefault();
}

// Close dropdowns on focusout

let navbar = document.querySelector('.navbar');

navbar.addEventListener('focusout', function() {

  window.onclick = function(event){
    if (document.querySelector('.navbar').contains(event.target)){
      return;
    } else{
      closeMenus();
    }
  };
});
</script>

