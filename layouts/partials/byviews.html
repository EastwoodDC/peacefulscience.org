{{ $alltime := getJSON "https://raw.githubusercontent.com/PeacefulScience/analytics/master/mostread.json" }}
{{ $trending := getJSON "https://raw.githubusercontent.com/PeacefulScience/analytics/master/trending.json" }}


{{ range $alltime }}
  {{ $data := . }}
  {{ with site.GetPage (index . 0) }}
    {{ .Scratch.Add "Views" (int (index $data 1))  }}
    {{ .Scratch.Add "Sessions" (int (index $data 2)) }}
  {{ end }}
{{ end }}

{{ range $trending }}
  {{ $data := . }}
  {{ with site.GetPage (index . 0) }}
    {{ .Scratch.Add "Trending" (index $data 1) }}
    {{ .Scratch.Add "Trending" (mul 2 (index $data 2)) }}
  {{ end }}
{{ end }}

{{ $collection := (slice ) }}
{{ range .Site.Pages }}
    {{ $item := (dict "Page" .) }}
    {{ $item = merge $item (dict "Views"  ( .Scratch.Get "Views" | default 0 )) }}
    {{ $item = merge $item (dict "Sessions"  ( .Scratch.Get "Sessions"  | default 0 )) }}
    {{ $item = merge $item (dict "Trending"  ( .Scratch.Get "Trending"  | default 0 )) }}
    
    {{ $collection = $collection | append (slice $item)  }}
{{ end }}

{{ $out := (slice )}}
{{ range sort $collection "Views" "desc" }}
  {{ $out = $out | append .Page }}
{{ end }}
{{ $byviews := $out }}

{{ $out := (slice )}}
{{ range sort $collection "Sessions" "desc" }}
  {{ $out = $out | append .Page }}
{{ end }}
{{ $bysessions := $out }}

{{ $out := (slice )}}
{{ range sort $collection "Trending" "desc" }}
  {{ $out = $out | append .Page }}
{{ end }}
{{ $bytrending := $out }}

{{ return (dict "ByTrending" $bytrending "ByViews" $byviews "BySessions" $bysessions) }}
